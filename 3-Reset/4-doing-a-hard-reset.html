<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Doing a hard reset | Git from the Bottom Up</title>

    <!-- Styles and fonts -->
    <link href="../themes/hamilton/stylesheets/hamilton.css" rel="stylesheet" type="text/css" />
    <link href="../themes/hamilton/stylesheets/syntax.css" rel="stylesheet" type="text/css" />

    <link href='//fonts.googleapis.com/css?family=Crimson+Text:400,400italic,700italic,700' rel='stylesheet' type='text/css'>

    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

    <script src="../themes/hamilton/javascripts/modernizr.js" type="text/javascript"></script>
  </head>

  <body class="x3-Reset x3-Reset_4-doing-a-hard-reset hamilton">
    <div class="page-wrapper">

      <!--[if lt IE 7]>
          <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
      <![endif]-->

      <header class="page-header" role="banner">
<a class="invisilink" href="../">            <span class="book-title">Git from the Bottom Up</span>
</a>        <span class="book-author visuallyhidden">by John Wiegley</span>
      </header>

      <div class="content-wrapper clearfix">
        <div class="toc" id="toc">
          <a href="#" class="toc-title" id="toc-title"><h3>Table of Contents</h3></a>
          <nav role="navigation" id="toc-nav" style="display: none;">
            <ul id="toc-list">
              <li class='child '><a href="../">Introduction</a></li><li class='parent'><span class='parent-label'>1 Repository</span><ul><li class='child '><a href="../1-Repository/1-directory-content-tracking.html">Repository: Directory content tracking</a></li><li class='child '><a href="../1-Repository/2-introducing-the-blob.html">Introducing the blob</a></li><li class='child '><a href="../1-Repository/3-blobs-are-stored-in-trees.html">Blobs are stored in trees</a></li><li class='child '><a href="../1-Repository/4-how-trees-are-made.html">How trees are made</a></li><li class='child '><a href="../1-Repository/5-the-beauty-of-commits.html">The beauty of commits</a></li><li class='child '><a href="../1-Repository/6-a-commit-by-any-other-name.html">A commit by any other name&hellip;</a></li><li class='child '><a href="../1-Repository/7-branching-and-the-power-of-rebase.html">Branching and the power of rebase</a></li><li class='child '><a href="../1-Repository/8-interactive-rebasing.html">Interactive rebasing</a></li></ul></li><li class='parent'><span class='parent-label'>2 the Index</span><ul><li class='child '><a href="../2-The-Index/1-meet-the-middle-man.html">The Index: Meet the middle man</a></li><li class='child '><a href="../2-The-Index/2-taking-the-index-further.html">Taking the index further</a></li></ul></li><li class='parent'><span class='parent-label'>3 Reset</span><ul><li class='child '><a href="1-to-reset-or-not-to-reset.html">To reset, or not to reset</a></li><li class='child '><a href="2-doing-a-mixed-reset.html">Doing a mixed reset</a></li><li class='child '><a href="3-doing-a-soft-reset.html">Doing a soft reset</a></li><li class='child active'><a href="4-doing-a-hard-reset.html">Doing a hard reset</a></li></ul></li><li class='child '><a href="../4-Stashing-and-the-reflog.html">Stashing and the reflog</a></li><li class='child '><a href="../5-Conclusion.html">Conclusion</a></li><li class='child '><a href="../6-Further-Reading.html">Further reading</a></li><li class='parent'><span class='parent-label'>Assets</span><ul><li class='parent'><span class='parent-label'>Git From the Bottom up.mellel</span><ul><li class='parent'><span class='parent-label'>Images</span><ul></ul></li></ul></li></ul></li>
            </ul>
          </nav>
        </div>
        <section class="main-content" role="main">
          <div class="main-content-source">
            <h1>Doing a hard reset</h1>

<p>A hard reset (the <code>--hard</code> option) has the potential of being very dangerous, as it’s able to do two different things at once: First, if you do a hard reset against your current HEAD, it will erase all changes in your working tree, so that your current files match the contents of HEAD.</p>

<p>There is also another command, <code>checkout</code>, which operates just like <code>reset --hard</code> if the index is empty. Otherwise, it forces your working tree to match the index.</p>

<p>Now, if you do a hard reset against an earlier commit, it’s the same as first doing a soft reset and then using reset <code>--hard</code> to reset your working tree. Thus, the following commands are equivalent:</p>
<pre class="highlight shell"><span class="gp">$ </span>git reset --hard HEAD~3  <span class="c"># Go back in time, throwing away changes</span>
<span class="gp">$ </span>git reset --soft HEAD~3  <span class="c"># Set HEAD to point to an earlier commit</span>
<span class="gp">$ </span>git reset --hard  <span class="c"># Wipe out differences in the working tree</span>
</pre>

<p>As you can see, doing a hard reset can be very destructive. Fortunately, there is a safer way to achieve the same effect, using the Git stash (see the next section):</p>
<pre class="highlight shell"><span class="gp">$ </span>git stash
<span class="gp">$ </span>git checkout -b new-branch HEAD~3   <span class="c"># head back in time!</span>
</pre>

<p>This approach has two distinct advantages if you’re not sure whether you really want to modify the current branch just now:</p>

<ol>
<li>It saves your work in the stash, which you can come back to at any time. Note that the stash is not branch specific, so you could potentially stash the state of your tree while on one branch, and later apply the differences to another.</li>
<li>It reverts your working tree back to a past state, but on a new branch, so if you decide to commit your changes against the past state, you won’t have altered your original branch.</li>
</ol>

<p>If you do make changes to <code>new-branch</code> and then decide you want it to become your new master branch, run the following commands:</p>
<pre class="highlight shell"><span class="gp">$ </span>git branch -D master  <span class="c"># goodbye old master (still in reflog)</span>
<span class="gp">$ </span>git branch -m new-branch master  <span class="c"># the new-branch is now my master</span>
</pre>

<p>The moral of this story is: although you can do major surgery on your current branch using <code>reset --soft</code> and <code>reset --hard</code> (which changes the working tree too), why would you want to? Git makes working with branches so easy and cheap, it’s almost always worth it to do your destructive modifications on a branch, and then move that branch over to take the place of your old master. It has an almost Sith-like appeal to it&hellip;</p>

<p>And what if you do accidentally run <code>reset --hard</code>, losing not only your current changes but also removing commits from your master branch? Well, unless you’ve gotten into the habit of using stash to take snapshots (see next section), there’s nothing you can do to recover your lost working tree. But you can restore your branch to its previous state by again using <code>reset --hard</code> with the reflog (this will also be explained in the next section):</p>
<pre class="highlight shell"><span class="gp">$ </span>git reset --hard HEAD@<span class="o">{</span>1<span class="o">}</span>   <span class="c"># restore from reflog before the change</span>
</pre>

<p>To be on the safe side, never use <code>reset --hard</code> without first running <code>stash</code>. It will save you many white hairs later on. If you did run stash, you can now use it to recover your working tree changes as well:</p>
<pre class="highlight shell"><span class="gp">$ </span>git stash  <span class="c"># because it's always a good thing to do</span>
<span class="gp">$ </span>git reset --hard HEAD~3  <span class="c"># go back in time</span>
<span class="gp">$ </span>git reset --hard HEAD@<span class="o">{</span>1<span class="o">}</span>  <span class="c"># oops, that was a mistake, undo it!</span>
<span class="gp">$ </span>git stash apply  <span class="c"># and bring back my working tree changes</span>
</pre>

          </div>
          <nav class="main-content-nav clearfix" role="navigation">
            <ul class="clearfix">
              <li><a class="previous" href="3-doing-a-soft-reset.html">Previous</a></li>
                <li><a class="next" href="../4-Stashing-and-the-reflog.html">Next</a></li>
            </ul>
          </nav>
        </section>

        </div><!-- end content-wrapper -->

      <footer class="page-footer">

        <div class="footer-wrapper clearfix" role="complementary">
          <!--
          <div class="block-pair clearfix">
            <div class="block downloads">
              <h3>Downloads</h3>
              <p>Download this book in
                  <a href="#">PDF</a>, <a href="#">mobi</a>, and <a href="#">epub</a>
                form for free.
              </p>
            </div>

            <div class="block translations">
              <h3>Book translations</h3>
              <p>This book is translated into
                <a href="#">Spanish</a>
                and <a href="#">English</a>.
                You can help with more translations <a href="https://github.com/jwiegley/git-from-the-bottom-up">on Github</a>.
              </p>
            </div>
          </div>
          -->
          <div class="block-pair clearfix">
            <div class="block license">
              <h3>License</h3>
              <p>This book is licensed under the <a href="https://creativecommons.org/licenses/by-nd/4.0">Attribution-NoDerivs</a> license.</p>
            </div>
            <div class="block open-source">
              <h3>This book is open source</h3>
              <p>The source of this book is <a href="https://github.com/jwiegley/git-from-the-bottom-up">hosted on Github</a>. Go, ahead. Check it out.</p>
            </div>
          </div>

          <div class="small-text"><small>Made with <a href="http://bitbooks.cc">Bitbooks</a></small></div>

        </div><!-- end footer-wrapper -->

      </footer>


    </div><!-- end page-wrapper -->

    <!-- include scripts just before the close of the body tag -->
    <script src="../themes/hamilton/javascripts/anchor.min.js" type="text/javascript"></script>
    <script src="../themes/hamilton/javascripts/hamilton.js" type="text/javascript"></script>
  </body>
</html>